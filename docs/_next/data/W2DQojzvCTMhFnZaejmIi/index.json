{"pageProps":{"posts":[{"title":"I built a multiplayer voxel browser game engine.","date":"2023-04-25","contentHTML":"<h2>Intro &#38; TLDR;</h2>\n<p>This post is a retrospective on a <a href=\"https://github.com/kevzettler/multiplayer-voxel-browser-game-engine\">multiplayer voxel browser game engine</a> I built. This post will cover the squishy storytelling side of the project, and the <a href=\"https://github.com/kevzettler/multiplayer-voxel-browser-game-engine\">accompanying code repository</a> has all of the intricate technical details. This post is essentially a 2 part post. Read this and read the repo README.</p>\n<a href='/img/multiplayer-engine-post/play.gif'>\n  <img src='/img/multiplayer-engine-post/play.gif'\n       alt=\"Animated give of a 3d multiplayer browser engine\"\n       title=\"Demonstration of multiplayer game engine multiple players\" />\n</a><h3>Disclaimer</h3>\n<p>This project is a bit old and stale at the time of this post. Some of the tech decisions made sense during development but are questionable today. I will try to address that in this post. I started this project with very minimal game development experience. I had no idea how many things worked, shaders, 3d asset files, raw binary buffer manipulation, scene graphs, and physics engines. I learned all these skills and more during this project. This experience also helped me later land some major corporate jobs. This project was primarily active from 2017-2019; however, exploration for the project goes back to late 2016.</p>\n<a href='/img/multiplayer-engine-post/disclaimer.png'>\n  <img src='/img/multiplayer-engine-post/disclaimer.png'\n       alt=\"Should you build a custom engine? Yes.\"\n       title=\"Should you build a custom engine? Yes\" width=\"400\" />\n</a><h2>Inspiration &#38; motivation</h2>\n<p>I wanted to build a multiplayer browser game. I was very inspired by <code>.io</code> games and sites like <a href=\"https://iogames.space/\">iogames.space</a>. I love the <code>.io</code> gaming experience of copy-pasting a URL around and getting in a game with your friends. Furthermore, I wanted to recreate a canceled MMO called <a href=\"https://en.wikipedia.org/wiki/Exteel\">Exteel</a>. My background was in web development and design. I stuck with the tools and environment I was most familiar with.</p>\n<h3>Target features</h3>\n<ul><li>network multiplayer</li>\n<li>playable cross-platform in the browser</li>\n<li>Player avatar customization</li>\n<li>lazy loading assets</li>\n<li>shared client &#38; server game code</li>\n<li>third person camera</li>\n<li>platforming physics</li>\n<li>destructible environments</li>\n</ul>\n<p>I completed most of these features except for destructible environments. Destructible environments were a big driver for the voxel asset pipeline, assuming voxels would enable the destructibility. Another browser game <a href=\"https://github.com/Lallassu/VoxLords\">VoxLords</a> inspired the goal of destructible environments. VoxLords had good environmental destruction and captured my imagination. I started this out by forking and modifying VoxLords to be multiplayer.</p>\n<p><a href=\"https://twitter.com/lallassu/status/725401257377169409?s=20\">https://twitter.com/lallassu/status/725401257377169409?s=20</a></p>\n<p>After hacking on VoxLords, it was clear that making a captivating 3D multiplayer browser experience was possible. Unfortunately, Lallassu was correct, and there were some major performance issues in the VoxLords engine that would require extensive refactoring. I decided to start a new project.</p>\n<h4>Why I didn&#39;t use one of the megacorp engines</h4>\n<p>I was not happy with Unity and Unreal&#39;s HTML5 browser experience. Unity&#39;s HTML5 export creates a giant asset bundle where users must sit and watch a loading bar before playing. This loading bar experience was against my goals of lazy loading assets on demand. Additionally, Unity&#39;s multiplayer server-side support was sketchy and <a href=\"https://radcade.com/unity-multiplayer-netcode-for-gameobjects/\">still is</a>. Unreal had much stronger multiplayer support but similar issues with browser builds, and in addition, Unreal itself was too large to install on my laptop.</p>\n<h2>The work</h2>\n<p>After hacking the VoxLords multiplayer fork, I started by exploring multiple tech stacks concurrently and building a prototype in each. The stacks I looked at were Babylon.js, Three.js, &#38; Stackgl.</p>\n<h3>Tech stack requirements</h3>\n<p>The first requirement was support for the 3d asset pipeline. I had been working with voxel models in <a href=\"https://ephtracy.github.io/\">MagicaVoxel .vox</a> format. The .vox format was great for static entities. There are primarily two ways to animate a voxel model. You can create frame-based animation, in which each frame is a separate voxel animation, and then you morph or swap them out at runtime. Or you can apply skeletal transformation data to voxel meshes. If you decide on the skeletal route, you must break the voxel mesh into smaller meshes corresponding to the skeleton bones.</p>\n<p>I had a character mesh that I wanted to use in .vox format, but at the time MagicaVoxel did not support multiple meshes. I converted the .vox file to <a href=\"https://www.getqubicle.com/\">quiblce .qb</a> file and broke the character up into separate meshes.</p>\n<a href='/img/multiplayer-engine-post/qubicle.png'>\n  <img src='/img/multiplayer-engine-post/qubicle.png'\n       alt=\"Qubicle UI breaking a mesh up.\"\n       title=\"Using Qubicle to break up a mesh for skeletal animation\"/>\n</a><p>I then imported the segmented Qubicle mesh into Blender and built the skeletal animations in Blender.</p>\n<a href='/img/multiplayer-engine-post/blender.gif'>\n  <img src='/img/multiplayer-engine-post/blender.gif'\n       alt=\"Blender skeletal walking animation.\"\n       title=\"Voxel model animated in Blender with skeletal animation\"/>\n</a><p>The engine then combines the animation data and voxel mesh data at runtime.</p>\n<p><a href=\"https://twitter.com/kevzettler/status/1002235365246222336?s=20\">https://twitter.com/kevzettler/status/1002235365246222336?s=20</a></p>\n<h3>Tech stack evaluation</h3>\n<ul><li><a href=\"https://threejs.org/\">three.js</a><p>I looked at Three.js first because VoxLords was built with it. The Three.js - Blender pipeline had issues, and we could not utilize skeletal animation imports. A colleague of mine who was working on a Three.js project captured some of the <a href=\"https://gist.github.com/AndrewRayCode/746be166c3008a03167206aec4a46531\"> three.js blender exporter issues</a> at the time. The Three.js - Blender compatibility issues were a deal breaker for me.</p>\n<p>Furthermore, Three.js did not have a viable headless server-side offering. Three.js uses custom math libraries that were not easily extractable from the rendering code. This tight coupling of math primitives and client render code meant multiplayer support would take a lot of extra duplicate work, re-implementing the game logic on the server. Three.js has advanced significantly since then, and I don&#39;t think these are issues anymore.</p>\n</li>\n<li><a href=\"https://www.babylonjs.com/\">babylon.js</a><p>I made some immediate promising progress in Babylon.js. The asset pipeline was robust and supported skeletal animation data. Babylon has a camera and physics out of the box. The Babylon team and community were super responsive and supportive. I hit a wall with Babylon.js when building the multiplayer server. Like Three.js, Babylon.js had no headless mode. Again, building multiplayer would require duplicate work reproducing all the simulation logic and physics in the server-side codebase. Recent versions of Babylon have a robust headless mode and have decoupled the framework into smaller libraries. These days Three.js is the king of the normie mindshare lexicon, but I still find Babylon.js a much better offering.</p>\n</li>\n<li><a href=\"http://stack.gl/\">stackgl</a><p>Stackgl is the dark horse of this list. Stackgl is not trying to be a complete 3D engine like Three.js and Babylon.js. Stackgl is an ecosystem of small functional tools that can be composed to create 3d browser experiences. Stackgl follows the Unix philosophy of &#34;small sharp tools.&#34; Stackgl has some main pillars: Rendering, Math, and Data. Stackgl handles rendering by focusing on direct shader code. Babylon.js and Three.js try to abstract shaders heavily away. Stackgl&#39;s primary rendering module is <a href=\"http://regl.party/\">Regl</a>, which provides an entirely novel stateless rendering pattern. Stackgl then provides many small functional math modules for vertex and geometry data. I was quickly more productive in Stackgl than in the previous two stacks.</p>\n<p>The modular nature made it very easy to share code between the client and server, easy to optimize performance and rendering, and easy to add custom functionality. For example, Babylon.js and Three.js have their own vector math implementation libraries. Then if you use a physics engine, the physics engines have their internal vector math libraries. Furthermore, if you use a multiplayer server, you will also need a vector math library there.</p>\n</li>\n</ul>\nIn Babylon and Three, it becomes a lot of fake work converting and serializing between different vector implementations. In Stackgl, you can easily use the same <a href=\"https://glmatrix.net/\">gl-matrix vector math library</a> across a project which is a huge productivity gain.<a href='/img/multiplayer-engine-post/engines.png'>\n  <img src='/img/multiplayer-engine-post/engines.png'\n       alt=\"Screenshot of GitHub showing multiple game engines.\"\n       title=\"Which 3d browser engine is best?\" />\n</a><p><b>When I started progressing with Stackgl, I took a year off and worked on it full-time throughout 2017.</b></p>\n<h2>What went wrong</h2>\n<p>Unfortunately, I consider this project unfinished. I did not ship a complete game experience, and there are some issues with the engine that would be risky for production deployment. I&#39;m writing this post to put closure on the project before moving on to new work and in the hopes that this experience may be helpful to any others interested in this space.</p>\n<h4>React vs. Vanilla Js</h4>\n<p>Most of my web development experience has been with the React framework, and I thought it would complement Regl and the Stackgl ecosystem&#39;s functional paradigm. I created a <a href=\"https://github.com/kevzettler/react-regl\">react reconciler to bridge React and Regl</a>. I started using a React stack with Redux to manage all the game state and state transitions. This React+Redux combo turned out to be a huge boon when writing UI. Game developers in traditional engines constantly complain about UI being their least favorite task. The game dev UI complaint is because game engines use geriatric 2-way mutable state management UI code that is error-prone and brittle. Web developers have solved these UI complaints and built tools like React that make creating UIs easy.</p>\n<a href='/img/multiplayer-engine-post/react.gif'>\n  <img src='/img/multiplayer-engine-post/react.gif'\n       alt=\"animated gif of a React 3d browser UI.\"\n       title=\"React 3d player avatar creation system\" width=\"400\" />\n</a><p>React+Redux setup was too much performance overhead for the real-time gameplay section. The state updates through the Redux action reducer pipeline, and the minimal React render updates were enough to cause noticeable hiccups in the gameplay frame rate. Performance in the browser environment is susceptible to garbage collector management. To minimize garbage collector hits, you need to use object pooling. Object pooling is a mutable state management pattern in which you pre-allocate a pool of objects. The collection of allocated objects gets mutated and reused during the program&#39;s life to minimize runtime memory allocations. This object pooling pattern conflicts with the immutable update patterns of React and Redux. Hitting these performance issues was a significant roadblock and essentially became a &#39;rewrite&#39; in which I had to rewrite the game state management to be performance optimized. This rewrite was costly and took a lot of time.</p>\n<h4>Hobby time</h4>\n<p>When I started progressing with Stackgl, I took a year off and worked on it full-time throughout 2017. I lived off some savings and unemployment checks until late 2018. I got back into corporate wage slavery from 2018-2020. During this time, I was invited to Animecon 2019 indie developer section to shill my game in the Indie game section.</p>\n<a href='/img/multiplayer-engine-post/animecon.png'>\n  <img src='/img/multiplayer-engine-post/animecon.png'\n       alt=\"A photo of me at Animecon 2019.\"\n       title=\"Playing a game with a 2B cosplayer at Animecon 2019\" />\n</a><p>During this time, I switched to hobby mode and started putting less and less time into development. I was maybe averaging 4 hours a week. I was distracted by day job work. This time shortage slowed development progress. Development picked up during the 2020 Covid lockdowns. Unfortunately, returning to development after a hiatus presented some new challenges.</p>\n<h5>Software entropy</h5>\nThe JavaScript ecosystem is known for moving incredibly fast. I spent much time-fighting severe software entropy when I returned to development. Getting the project to build with the latest dependency chains of Node+NPM+webpack etc., took a lot of work. The animation pipeline using Landon had severe entropy. Landon is a mix of Rust, JavaScript, and Blender versions that are not strictly pinned. The Landon developer was changing the data output format and abandoned the skeletal animation system I used. I had to do work to upgrade to the latest Blender export versions but then write backward compatibility translation layers for the animation data. I upgraded my laptop to an M1 Mac. The M1 transition triggered a roadblock on the project because the WebRTC module I used would not compile on the new M1 Apple silicon chip. The WebRTC module now supports M1 architectures but was pretty much the show-stopper.<h2>Byproducts</h2>\n<p>The work put into this project spun off some valuable libraries I have open-sourced and put on GitHub.</p>\n<ul><li><a href=\"https://github.com/kevzettler/react-regl\">react-regl</a><p>A react reconciler to bridge React and Regl</p>\n</li>\n<li><a href=\"https://github.com/kevzettler/parse-magica-voxel\">parse-magica-voxel</a><p>A JavaScript parser for the Magicavoxel .vox binary file format</p>\n</li>\n<li><a href=\"https://github.com/kevzettler/parse-qubicle\">parse-quibicle</a><p>A JavaScript parser for the .qb binary file format.</p>\n</li>\n<li><a href=\"https://github.com/kevzettler/gl-swept-sphere-triangle\">gl-swept-sphere-triangle</a><p>A swept sphere to polygon collision detection algorithm</p>\n</li>\n</ul>\n<h2>Shout outs</h2>\n<p>I built this project with the help and research of other highly skilled software engineers. Their contributions were critical to the development of this project.</p>\n<ul><li><a href=\"https://twitter.com/MikolaLysenko\">Mikola lysenko</a><p>Mikola is a primary driver of the Stackgl ecosystem and a certified 10x genius developer. His blog <a href=\"https://0fps.net\">0fps.net</a> has some mind-melting content on high-performance computer science and geometry. Mikola assembled a team and built a Roblox clone for China in the browser. The team got together for a podcast to discuss their <a href=\"https://www.youtube.com/watch?v=Z_--8z549D4\">Reflections on building web-based voxel MMO in China (Mikola Lysenko, et al) - YouTube</a>  It is a highly insightful talk, highly recommend if you found this post interesting.</p>\n</li>\n<li><a href=\"https://chinedufn.com/\">Chinedu Francis Nwafili</a><p>Chinedu did terrific work by building the <a href=\"https://github.com/chinedufn/skeletal-animation-system\">stackgl skeletal animation system</a>, which is a vital piece of the Stackgl ecosystem, and this project was highly dependent on and probably couldn&#39;t have come together without. While I was building this project, Chinedu also created his own game and engine. We kept in correspondence while making and sharing ideas. Chinedu also built out a very cool suite of tools for Blender called <a href=\"https://github.com/chinedufn/landon\">landon</a>. Landon makes Blender a source of truth for game engine data. Chinedu&#39;s blog at <a href=\"https://chinedufn.com/\">https://chinedufn.com/</a> has in-depth development journal posts on his game engine development.</p>\n</li>\n<li><a href=\"http://www.jameswarlloyd.com/\">James Warlloyd</a><p>James created the <a href=\"https://opengameart.org/content/voxel-mech-sniper\">original mech model</a> that I used as the bases for the character art in this engine.</p>\n</li>\n</ul>\n<h2>The state of the art</h2>\n<p>Overall this project was a significant educational return on investment for me. I learned about hardcore browser optimization and many other data-processing techniques. I have continued to do game ( and engine ) development as a hobby and have already looked into some other emerging technologies. My focus is still on browser multiplayer experiences. I haven&#39;t found the big engines: Unreal, Unity, and Godot have the best models for multiplayer. I have previously written about <a href=\"https://radcade.com/how-to-add-network-multiplayer-to-your-indie-game/\">multilpayer game engine design for indies</a>. The big engines use coding patterns that couple game simulation code to rendering code. This coupling makes it challenging to build a server as you have to decouple the simulation and run it headless.</p>\n<ul><li><a href=\"https://dotbigbang.com/\">DotBigBang</a><p>DotBigBang is everything this project attempted to be and more. It is a multiplayer voxel 3d engine, all fully in the browser. DotBigBang is focused on user-generated content and is essentially a multiplayer game engine. You can get a group of people together, bring your avatars into a 3D scene, and then collaboratively edit and program that scene like a multiplayer Unity editor experience. I had the fortune to hang with the founder of DotBigBang at GDC 2023 and hear about some impressive browser performance optimization they were doing. He told me about forking Chromium to have better performance debugging visibility into how the JIT compilation and memory usage of the browser was working.</p>\n</li>\n<li><a href=\"https://github.com/matrix-org/thirdroom#manifold-engine\">Manifold engine</a><p>The Manifold engine is a stealthy engine currently in development by the <a href=\"https://matrix.org/\">matrix.org</a> team. Manifold is embedded in a repository for another project with a disclaimer they might release in the future. The host project is &#39;Thirdroom,&#39; a multiplayer VR metaverse platform.</p>\n<p>When I learned about Manifold I was very excited because it has the same design philosophy and high-performance computation architecture that I had been building towards. It uses Web Workers to create multiple threads to process rendering, physics, and networking separately. All the threads share memory over a <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer\">SharedArrayBuffer</a>, and they use object pooling to reduce garbage collection. Manifold also has WebRTC Data channels for networking. I built a promising prototype in Manifold; unfortunately, Manifold is tightly coupled to a matrix.org backend. The matrix backend has a clunky API to use, which would make custom server-side optimization challenging. If the matrix.org team ever decouples and delivers Manifold, it would be a very compelling option.</p>\n</li>\n<li><a href=\"https://github.com/AmbientRun/Ambient\">Ambient engine</a><p>Ambient is a promising new Rust lang engine. It is a default multiplayer engine. It shares code between the client and server. It compiles game code to WASM and then acts as a cross-platform binary runtime to execute that WASM. I have built a promising prototype in Ambient but unfortunately Ambient does not currently make for browser environments. The Ambient team is actively working to target browsers and is aiming for an upcoming release.</p>\n</li>\n</ul>\n<h2>Intro &#38; TLDR;</h2>\n<p>This post is a retrospective on a <a href=\"https://github.com/kevzettler/multiplayer-voxel-browser-game-engine\">multiplayer voxel browser game engine</a> I built. This post will cover the squishy storytelling side of the project, and the <a href=\"https://github.com/kevzettler/multiplayer-voxel-browser-game-engine\">accompanying code repository</a> has all of the intricate technical details. This post is essentially a 2 part post. Read this and read the repo README.</p>\n<a href='/img/multiplayer-engine-post/play.gif'>\n  <img src='/img/multiplayer-engine-post/play.gif'\n       alt=\"Animated give of a 3d multiplayer browser engine\"\n       title=\"Demonstration of multiplayer game engine multiple players\" />\n</a><h3>Disclaimer</h3>\n<p>This project is a bit old and stale at the time of this post. Some of the tech decisions made sense during development but are questionable today. I will try to address that in this post. I started this project with very minimal game development experience. I had no idea how many things worked, shaders, 3d asset files, raw binary buffer manipulation, scene graphs, and physics engines. I learned all these skills and more during this project. This experience also helped me later land some major corporate jobs. This project was primarily active from 2017-2019; however, exploration for the project goes back to late 2016.</p>\n<a href='/img/multiplayer-engine-post/disclaimer.png'>\n  <img src='/img/multiplayer-engine-post/disclaimer.png'\n       alt=\"Should you build a custom engine? Yes.\"\n       title=\"Should you build a custom engine? Yes\" width=\"400\" />\n</a><h2>Inspiration &#38; motivation</h2>\n<p>I wanted to build a multiplayer browser game. I was very inspired by <code>.io</code> games and sites like <a href=\"https://iogames.space/\">iogames.space</a>. I love the <code>.io</code> gaming experience of copy pasting a URL around and getting in a game with your friends. Furthermore I wanted to recreate a canceled MMO called <a href=\"https://en.wikipedia.org/wiki/Exteel\">Exteel</a>. My background was in web development and design. I stuck with the tools and environment I was most familiar with.</p>\n<h3>Target features</h3>\n<ul><li>network multiplayer</li>\n<li>playable cross platform in browser</li>\n<li>player avatar customization</li>\n<li>lazy loading assets</li>\n<li>shared client &#38; server game code</li>\n<li>third person camera</li>\n<li>platforming physics</li>\n<li>destructible environments</li>\n</ul>\n<p>All these features were completed except for destructible environments. Destructible environments was a big driver for the voxel asset pipeline, assuming voxels would enable the destructibility. This idea was inspired by another browser game <a href=\"https://github.com/Lallassu/VoxLords\">VoxLords</a> which had good environmental destruction and captured my imagination. I actually started this out by forking and modifying VoxLords to be multiplayer.</p>\n<p><a href=\"https://twitter.com/lallassu/status/725401257377169409?s=20\">https://twitter.com/lallassu/status/725401257377169409?s=20</a></p>\n<p>After hacking on VoxLords it was clear that it was entirely possible to make a captivating 3D multiplayer browser experience. Unfortunately, Lallassu was correct and there were some major performance issues in the VoxLords engine that would require extensive refactoring. I decided to start a fresh project.</p>\n<h4>Why I didn&#39;t use one of the mega corp engines</h4>\n<p>I was not happy with Unity and Unreal&#39;s HTML5 browser experience. Unity&#39;s HTML5 export creates a giant asset bundle that users have to sit and watch a loading bar before playing. This was against my goals of lazy loading assets on demand. Additionally Unity&#39;s multiplayer server side support was sketchy and <a href=\"https://radcade.com/unity-multiplayer-netcode-for-gameobjects/\">still is</a>. Unreal had much stronger multiplayer support but similar issues with browser builds and in addition Unreal itself was too large to install on my laptop.</p>\n<h2>The work</h2>\n<p>After hacking the VoxLords multiplayer fork. I started by exploring multiple tech stacks concurrently and building a prototype in each of them. The stacks I looked at were Babylon.js, three.js, &#38; Stackgl.</p>\n<h3>Tech stack requirements</h3>\n<p>The first requirement was support for the 3d asset pipeline. I had been working with voxel models in <a href=\"https://ephtracy.github.io/\">MagicaVoxel .vox</a> format. This was great for static entities. There&#39;s primarily 2 ways to animate a voxel model. You can create frame based animation, in which you each frame of the animation is a separate voxel animation and then you morph or swap them out on at runtime. Or you can apply skeletal transformation data to voxel meshes. If you decide on the skeletal route you need to break the voxel mesh up into smaller mesh&#39;s that correspond to the skeleton bones.</p>\n<p>I had a character mesh that I wanted to use in .vox format but at the time MagicaVoxel did not support multiple meshes. I converted the .vox file to <a href=\"https://www.getqubicle.com/\">quiblce .qb</a> file and broke the character up into separate meshes.</p>\n<a href='/img/multiplayer-engine-post/qubicle.png'>\n  <img src='/img/multiplayer-engine-post/qubicle.png'\n       alt=\"Qubicle UI breaking a mesh up\"\n       title=\"Using Qubicle to break up a mesh for skeletal animation\"/>\n</a><p>The segmented qubicle mesh was then imported into Blender and animations were built in blender.</p>\n<a href='/img/multiplayer-engine-post/blender.gif'>\n  <img src='/img/multiplayer-engine-post/blender.gif'\n       alt=\"Blender skeletal walking animation\"\n       title=\"voxel model animated in blender with skeletal animation\"/>\n</a><p>The animation data and voxel meshes data was combined at runtime in the engine.</p>\n<p><a href=\"https://twitter.com/kevzettler/status/1002235365246222336?s=20\">https://twitter.com/kevzettler/status/1002235365246222336?s=20</a></p>\n<h3>Tech stack evaluation</h3>\n<ul><li><a href=\"https://threejs.org/\">three.js</a><p>VoxLords was built in Three.js so I looked at it first. The Three.js - Blender pipeline was broken and could not get skeletal animation imports working. A colleague of mine who was working on a Three.js project captured some of the <a href=\"https://gist.github.com/AndrewRayCode/746be166c3008a03167206aec4a46531\"> three.js blender exporter issues</a> at the time. This was a deal breaker for me.</p>\n<p>Furthermore, Three.js did not have a good headless server side offering. Three.js uses custom math libraries that were not easily extract-able from the rendering code. This meant multiplayer support would take a lot of extra duplicate work, re-implementing the game logic on the server. Three.js has advanced significantly since then, I don&#39;t think these are issues anymore.</p>\n</li>\n<li><a href=\"https://www.babylonjs.com/\">babylon.js</a><p>I made some immediate promising progress in Babylon.js. The asset pipeline was robust and supported skeletal animation data. Babylon has camera and physics out of the box. The Babylon team and  community was super responsive and supportive. I hit a wall with Babylon.js when trying to build out the multiplayer server. Like Three.js, Babylon.js had no headless mode. Again, this meant that building multiplayer would require duplicate work reproducing all the simulation logic and physics in the server side codebase. Recent versions of Babylon have a robust headless mode and have decoupled the framework into smaller libraries. These days Three.js is king of the normie browser 3d mind share lexicon but I still find Babylon.js a much better offering.</p>\n</li>\n<li><a href=\"http://stack.gl/\">stackgl</a><p>Stackgl is the dark-horse of this list. Stackgl is not trying to be a complete 3D engine like Three.js and Babylon.js. Stackgl is an ecosystem of small functional tools that can be composed to create 3d browser experiences. Stackgl follows the unix philosophy of &#34;small sharp tools&#34;. Stackgl has some main pillars: Rendering, Math, and Data. Stackgl handles rendering by focusing on direct shader code. Babylon.js and Three.js try to heavily abstract shaders away. Stackgl&#39;s primary rendering module is <a href=\"http://regl.party/\">Regl</a> which provides a completely novel stateless rendering pattern. Stackgl then provides many small functional math modules for dealing with vertex and geometry data. I was quickly more productive in Stackgl than the previous two stacks.</p>\n<p>The modular nature made it very easy to share code between the client and server, easy to optimize performance and rendering, and easy to add custom functionality. For example Babylon.js and Three.js have their own vector math implementation libraries. Then if you use a physics engine with the physics engines have their own intern vector math libraries. furthermore if you use a multiplayer server you will need a vector math library there as well.</p>\n</li>\n</ul>\nIn Babylon and Three it becomes a lot of fake work converting and serializing between different vector implementations. In Stackgl you can easily use the same <a href=\"https://glmatrix.net/\">gl-matrix vector math library</a> across a project which is a huge productivity gain.<a href='/img/multiplayer-engine-post/engines.png'>\n  <img src='/img/multiplayer-engine-post/engines.png'\n       alt=\"Screenshotf of github showing multiple game engines\"\n       title=\"Which 3d browser engine is best?\" />\n</a><p><b>When I started making progress with Stackgl I took a year off and worked on it full time throughout 2017.</b></p>\n<h2>What went wrong</h2>\n<p>Unfortunately, I consider this project unfinished. I did not ship a complete game experience and there are some issues with the engine that would be risky for production deployment. I&#39;m writing this post to put closure on the project before moving on to new work and in the hopes that this experience may be useful to any others interested in this space.</p>\n<h4>React vs Vanilla Js</h4>\n<p>Most my web development experience has been with the React framework and I thought it would be complementary to Regl and the stack.gl ecosystem&#39;s functional paradigm. I created a <a href=\"https://github.com/kevzettler/react-regl\">react reconciler to bridge react and regl</a>. I started using a React stack with Redux to manage all the game state and state transitions. This React+Redux combo turned out to be a huge boon when writing UI. Game developers in traditional engines constantly complain about UI being their least favorite task. This is because game engines use traditional 2-way mutable state management UI code that is error prone and brittle. Web developers have solved these UI complaints and built tools like React that make building UI&#39;s easy.</p>\n<a href='/img/multiplayer-engine-post/react.gif'>\n  <img src='/img/multiplayer-engine-post/react.gif'\n       alt=\"animated gif of a React 3d browser UI\"\n       title=\"React 3d player avatar creation system\" width=\"400\" />\n</a><p>React+Redux setup was too much performance overhead for the real time game play section. The state updates through the Redux action reducer pipeline, combined with the minimal React render updates was enough to cause noticeable hiccups in the game play frame rate. Performance in the browser environment is very sensitive to garbage collector management. In order to minimize garbage collector hits you need to use object pooling. Object pooling is a mutable state management pattern in which you pre-allocate a pool of objects that will be mutated during the life of the program to minimize runtime memory allocations. This object pooling pattern conflicts with the immutable update patterns React and Redux are built upon. Hitting these performance issues was a big roadblock and essentially became a &#39;rewrite&#39; in which had to rewrite the game state management to be performance optimized. This was costly and took a lot of time.</p>\n<h4>Hobby time</h4>\n<p>When I started making progress with Stackgl I took a year off and worked on it full time throughout 2017. I lived off some savings and unemployment checks until late 2018 I got back into corporate wage slavery from 2018-2020. A highlight during this time was I got invited to Animecon 2019 indie developer section to shill my game in the Indie game section.</p>\n<a href='/img/multiplayer-engine-post/animecon.png'>\n  <img src='/img/multiplayer-engine-post/animecon.png'\n       alt=\"A photo of me at animecon 2019 \"\n       title=\"Playing a game with a 2B cosplayer at animecon 2019\" />\n</a><p>During this time I switched to hobby mode started putting less and less time into development I was maybe averaging 4 hours a week. I was distracted by day job work. This time shortage slowed development progress. Development picked up during 2020 Covid lockdowns unfortunately getting back into development after a hiatus presented some new challenges...</p>\n<h5>Software entropy</h5>\nThe JavaScript ecosystem is known for moving incredibly fast. When I got back into development I spent a lot of time fighting severe software entropy. Getting the project to build with latest dependency chains of Node+NPM+webpack etc took a lot of work. The animation pipeline using Landon had severe entropy. The Landon was a mix of Rust, JavaScript and Blender versions that were not strictly pinned. I had to do work to upgrade to the latest Blender export versions but then write backwards compatibility translation layers for the animation data. I upgraded my laptop to an M1 Mac. This triggered a roadblock on the project because the WebRTC module I was using would not compile on the new M1 apple silicon chip. This has since been resolved but was pretty much the show stopper.<h2>Byproducts</h2>\n<p>The work put into this project spun-off some useful libraries that I have open sourced and put on github</p>\n<ul><li><a href=\"https://github.com/kevzettler/react-regl\">react-regl</a><p>A react reconciler to bridge react and regl</p>\n</li>\n<li><a href=\"https://github.com/kevzettler/parse-magica-voxel\">parse-magica-voxel</a><p>A JavaScript parser for the magicavoxel .vox binary file format</p>\n</li>\n<li><a href=\"https://github.com/kevzettler/parse-qubicle\">parse-quibicle</a><p>A JavaScript parser for the .qb binary file format.</p>\n</li>\n<li><a href=\"https://github.com/kevzettler/gl-swept-sphere-triangle\">gl-swept-sphere-triangle</a><p>A swept sphere to polygon collision detection algorithm</p>\n</li>\n</ul>\n<h2>Shout outs</h2>\n<p>This project was built on the work and research of other highly skilled software engineers. Without their help</p>\n<ul><li><a href=\"https://twitter.com/MikolaLysenko\">Mikola lysenko</a><p>Mikola is a primary driver of the stack.gl ecosystem and certified 10x genius developer. His blog <a href=\"https://0fps.net\">0fps.net</a> has some mind melting content on high performance computer science, and geometry. Mikola assembled a team and basically built a Roblox clone for China in the browser. The team got together for a podcast to discuss their <a href=\"https://www.youtube.com/watch?v=Z_--8z549D4\">Reflections on building web-based voxel MMO in China (Mikola Lysenko, et al) - YouTube</a>  It is a highly insighful talk, highly recommend if you found this post interesting.</p>\n</li>\n<li><a href=\"https://chinedufn.com/\">Chinedu Francis Nwafili</a><p>Chinedu did amazing work by building the <a href=\"https://github.com/chinedufn/skeletal-animation-system\">stackgl skeletal animation system</a> which is a key piece of the stack.gl ecosystem and this project was highly dependent on and probably couldn&#39;t have come together without. While I was building out this project Chinedu was also building out his own game and engine we kept in correspondence while building and sharing ideas. Chinedu also built out a very cool suite of tools for Blender called <a href=\"https://github.com/chinedufn/landon\">landon</a>. Making Blender a source of truth for game engine data. Chinedu&#39;s blog at <a href=\"https://chinedufn.com/\">https://chinedufn.com/</a> has in-depth development journal posts on his game engine development.</p>\n</li>\n<li><a href=\"http://www.jameswarlloyd.com/\">James Warlloyd</a><p>James created the <a href=\"https://opengameart.org/content/voxel-mech-sniper\">original mech model</a> that I used as the bases for the character art in this engine.</p>\n</li>\n</ul>\n<h2>The state of the art</h2>\n<p>Overall this project was a big educational return on investment for me. I learned about hardcore browser optimization and many other data processing techniques. I have continued to do game ( and engine ) development as a hobby and have already looked into some other emerging technologies. My focus is still on browser multiplayer experiences. I haven&#39;t found the big engines: Unreal, Unity, Godot have the best models for multiplayer. I have previously written about <a href=\"https://radcade.com/how-to-add-network-multiplayer-to-your-indie-game/\">multilpayer game engine design for indies</a>. The big engines have models that couple game simulation logic code to rendering code. This makes it challenging to build a server as you have to decouple the simulation and run it headless.</p>\n<ul><li><a href=\"https://dotbigbang.com/\">DotBigBang</a><p>DotBigBang is everything this project attempted to be and more. It is multiplayer voxel 3d engine all fully in the browser. DotBigBang is focused on user generated content and is essentially a multiplayer game engine. You can get a group of people together and bring your avatars into a 3D scene and then collaboratively edit and program that scene. Like a multiplayer Unity editor experience. I had the fortune to hang with the founder of DotBigBang at GDC 2023 and hear about some of the impressive browser performance optimization they were doing. He told me about forking Chromium to have better performance debugging visibility into how the JIT compilation and memory usage of the browser was working.</p>\n</li>\n<li><a href=\"https://github.com/matrix-org/thirdroom#manifold-engine\">Manifold engine</a><p>The Manifold engine is a stealthy engine being developed by the <a href=\"https://matrix.org/\">matrix.org</a> team. Its currently embedded in a repository for another project with a disclaimer they might release it in the future. The host project is called &#39;thirdroom&#39; and is a multilpayer VR metaverse platform.</p>\n<p>When I learned about Manifold I was very excited because it has the same design philosophy and high performance computation architecture that I had been building towards. It uses Web Workers to create multiple threads to separately process rendering, physics, and networking. All the threads share memory over a <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer\">SharedArrayBuffer</a> and they use object pooling to reduce garbage collection. Manifold also has WebRTC Data channels for networking. I was able to build a promising prototype in Manifold unfortunately Manifold is tightly coupled to a matrix.org backend. The matrix backend has a clunky API to use which would make custom server side optimization challenging. If the matrix.org team ever decouples and delivers Manifold it would be very compelling option.</p>\n</li>\n<li><a href=\"https://github.com/AmbientRun/Ambient\">Ambient engine</a><p>Ambient is a promising new Rust lang engine. It is a default multiplayer engine. It shares code between client and server. It compiles game code to WASM and then acts as a cross platform binary runtime to execute that WASM. I have built a promising prototype in Ambient but unfortunately Ambient does not currently build for browser environments. The Ambient team is actively working to target browsers and are aiming for an upcoming release.</p>\n</li>\n</ul>\n","excerpt":"Intro & TLDR;\nThis post is a retrospective on a multiplayer voxel browser game engine I built. This post will cover the squishy storytelling side of the project, and the accompanying code repository has all of the intricate technical details. This post is essentially a 2 part post. Read this and read the repo README.\n\n  \nDisclaimer\nThis project is a bit old and stale at the time of this post. ...","slug":"2023/04/25/multiplayer-voxel-game-engine","meta":{"keywords":"gamedev, javascript, react","image":"img/multilpayer-engine-post/meta.png","description":"Intro &#38; TLDR;\nThis post is a retrospective on a multiplayer voxel browser game engine I built. This post will cover the squishy storytelling side of the project, and the accompanying code repository has all of the intricate technical details. This post is essentially a 2 part post. Read this and"}},{"title":"Using Next.js for static sites","date":"2023-04-13","contentHTML":"<p>Good news everyone. I can post here again, thank you Next.js. If you check the history of post dates here you can see some large gaps between updates. Until recently this site was powered by <a href=\"https://jekyllrb.com/\">Jekyll</a> and hosted on Github static pages. Jekyll had high entropy and every-time I wanted to do a spontaneous post I would have to update Jekyll and all its dependencies and usually update Ruby. Oftentimes this software entropy maintenance would kill my creative energy to make new content or like recently flat out block me from pushing updates. I have now migrated this blog to Next.js and still using Github static pages to host. Next.js has a static site feature similar to Jekyll. I&#39;m hoping it has less entropy.</p>\n<p>I am a heavy user of emacs and <a href=\"https://orgmode.org/\">orgmode</a>. I keep a lot of text data in orgmode, journals, agendas, task lists, notes. This blog post is written in orgmode. I could do a seperate blog post on my orgmode usage. It really some Alan Kay human computer augmentation level stuff. Next.js makes it very easy to convert orgmode files into HTML websites. Next.js makes it easy to fetch any data source and convert it to web content. I have now built up a some shared publishing code for Next.js that handles both Markdown and orgmode files and converts them to web content. I am using this to keep my web properties updated with fresh content.</p>\n","excerpt":"Good news everyone. I can post here again, thank you Next.js. If you check the history of post dates here you can see some large gaps between updates. Until recently this site was powered by Jekyll and hosted on Github static pages. Jekyll had high entropy and every-time I wanted to do a spontaneous post I would have to update Jekyll and all its dependencies and usually update Ruby. Oftentimes thi...","slug":"2023/04/13/migrating-to-nextjs","meta":{"keywords":"javascript, next.js, web development","image":"img/kev.jpeg","description":"Good news everyone. I can post here again, thank you Next.js. If you check the history of post dates here you can see some large gaps between updates. Until recently this site was powered by Jekyll and hosted on Github static pages. Jekyll had high entropy and every-time I wanted to do a spontaneous"}},{"title":"Dasung Linux Driver Decompiled","date":"2018-12-13","contentHTML":"<p>This is a follow up to the <a href=\"https://kevzettler.com/2018/02/11/dasung-paperlike-pro-teardown\">Dasung teardown</a> post in which I decompile the software drivers. Dasung ships their monitors with a Linux driver that is sadly limited to the Ubuntu amd64 architecture. The driver can be downloaded from:\n<a href=\"http://www.dasungtech.com/sta/en/software_en0310.html\">Dasung driver download page</a></p>\n<p>I have decompiled the drivers and uploaded them to github at:\n<a href=\"https://github.com/kevzettler/decompiled_dasung_drivers\">Dasung linux drivers source code decompiled</a></p>\n<p>I was naively hoping I could hack this to be ARM compatible so I could use the Dasung with a Raspberry PI. I have been told that is not feasible due to architecture differences and OS API compatibility concerns. However these Drivers can potentially be used to make mods for other AMD64 systems.</p>\n<p>When looking at the &#39;drivers&#39; provided by Dasung the contents of the Ubuntu folder are as follows:</p>\n<pre class=\"prettyprint\"><code class=\"language-bash\">-rwxrwxrwx@ 1 kev  staff  67646 Nov  2  2017 DS.ico\n-rwxrwxrwx@ 1 kev  staff  29404 Nov  2  2017 paperlikepro_1.0.5_amd64.deb\n-rwxrwxrwx@ 1 kev  staff    180 Nov  2  2017 readme</code>\n</pre>\n<ul><li><code>DS.ico</code><p>is an icon file of the Dasung logo</p>\n</li>\n<li><code>readme</code><p>is a text file explaining how to install the driver on Ubuntu systems</p>\n</li>\n<li><code>paperlikepro_1.0.5_amd64.deb</code><p>is a Debian package archive containing the compiled driver and other data. The <code>deb</code> file can be extracted to the following contents:</p>\n</li>\n</ul>\n<h2>paperlikepro_1.0.5_amd64.deb contents</h2>\n<pre class=\"prettyprint\"><code class=\"language-bash\">-rw-r--r--@ 1 kev  staff    279 Aug  4  2017 control.tar.gz\n-rw-r--r--@ 1 kev  staff  28932 Aug  4  2017 data.tar.xz\n-rw-r--r--@ 1 kev  staff      4 Aug  4  2017 debian-binary</code>\n</pre>\n<ul><li><code>debian-binary</code>is a text file that contains a version number<code>$ cat debian-binary 2.0</code></li>\n<li><code>control.tar.gz</code>is an archive that can be extracted using <code>tar</code>it expands to a text file <code>control</code> with the following content:</li>\n</ul>\n<pre class=\"prettyprint\"><code class=\"language-unknown\">$ cat control\nPackage: PaperlikePro\nVersion: 1.0.5\nSection: x11\nPriority: standard\nArchitecture: amd64\nDepends:\nInstalled-Size: 200\nMaintainer: support@dasung.com\nDescription: Paperlike Pro Software</code>\n</pre>\n<ul><li><code>data.tar.xz</code><p>This is where things get interesting. It is another tar archive which contains the executables of the driver. When extracted it produces the following:</p>\n</li>\n</ul>\n<pre class=\"prettyprint\"><code class=\"language-bash\">$ tar -xzvf data.tar.xz\nx ./\nx ./usr/\nx ./usr/local/\nx ./usr/local/sbin/\nx ./usr/local/sbin/PaperlikePro\nx ./usr/local/sbin/DS.ico\nx ./usr/local/sbin/ResChange</code>\n</pre>\n<p>This is meant to be installed at <code>/usr/local/sbin</code> on Ubuntu. We have already seen <code>DS.ico</code> and know it is the Dasung logo.</p>\n<p><code>PaperLikePro</code> and <code>ResChange</code> are both executables. I am assuming that <code>PaperlikePro</code> is the UI management tool found on other platforms and that <code>ResChange</code> is a resolution driving tool.</p>\n<h1>Converting amd64 binaries to other format</h1>\n<p>Using the <a href=\"https://github.com/yegord/snowman\">Snowman decompiler</a> tool against <code>PaperlikePro</code> and <code>ResChange</code> binaries I was able to produce some C++ decompiled source code. I have not attempted to re compile them and see if they work as expected. I have uploaded the decompiled code to github at <a href=\"https://github.com/kevzettler/decompiled_dasung_drivers\"><a href=\"https://github.com/kevzettler/decompiled_dasung_drivers\">https://github.com/kevzettler/decompiled_dasung_drivers</a></a>.</p>\n","excerpt":"This is a follow up to the Dasung teardown post in which I decompile the software drivers. Dasung ships their monitors with a Linux driver that is sadly limited to the Ubuntu amd64 architecture. The driver can be downloaded from:\nDasung driver download page\nI have decompiled the drivers and uploaded them to github at:\nDasung linux drivers source code decompiled\nI was naively hoping I could hack th...","slug":"2018/12/13/dasung-linux-driver-decompiled","meta":{"keywords":"e-ink hardware workflow laptop","image":"img/kev.jpeg","description":"Dasung Linux Ubuntu drivers open source decompiled"}},{"title":"Dasung Paperlike Pro Teardown","date":"2018-02-11","contentHTML":"<img src='/img/dasung_teardown/title.png'\n alt='Dasung Paperlike Pro control board says. Oops, you have lost the warranty :-('\n title='Dasung Paperlike Pro control board says. Oops, you have lost the warranty :-('\n/><blockquote><p><b>Disclaimer</b> This is my first real electronics, hardware project. I&#39;m picking this up as I go. I don&#39;t yet have a mature mental model on electronics. I appreciate any guidance and coaching in the comments.</p>\n</blockquote>\n<h2>Building a DIY E-ink or Epaper laptop</h2>\n<p>This is a follow up to my previous <a href=\"/2018/01/12/dasung-paperlike-pro-review\">Dasung Paperlike Pro Review</a> post. For visitors landing here, a quick recap. The Dasung Paperlike Pro is billed as &#34;The worlds first HDMI e-ink monitor&#34; It is high performance for a e-ink display and renders at about 40fps. Check the review post for more info.</p>\n<p>I Bought the Dasung with intentions to tear it down for &#39;research&#39; purposes. Mainly to confirm what e-ink display module they were using. This research was for the goal of building an <a href=\"https://www.youtube.com/watch?v=4-cVNJwhAqo\">e-ink laptop</a>. In this post I will walk through my experience dismantling the Dasung and discuss its internal components. Hopefully readers will find this useful in their own e-ink hardware projects, or in the chance they need to repair a Dasung.</p>\n<p>You can click through any of the images below for full high res versions.</p>\n<h2>How to open the Dasung Paperlike Pro</h2>\n<p>The Dasung has a seemingly, solid one piece construction. It took me a few days to devise a method of disassembly that wasn&#39;t aggressively destructive, like cracking the frame open with a hammer, or pry-bar. After prodding it for a few days I discovered the front outer frame bezel was glued on and could be pried with a knife.</p>\n<a href='/img/dasung_teardown/2017-12-26 19.49.20.jpg'>\n  <img src='/img/dasung_teardown/2017-12-26 19.49.20.jpg' alt=\"How to remove Dasung Paperlike Pro faceplate\" title=\"How to remove Dasung Paperlike Pro faceplate\" />\n</a><a href='/img/dasung_teardown/2017-12-26 19.49.39.jpg'>\n  <img src='/img/dasung_teardown/2017-12-26 19.49.39.jpg' alt=\"How to remove Dasung Paperlike Pro faceplate\" title=\"How to remove Dasung Paperlike Pro faceplate\" />\n</a><a href='/img/dasung_teardown/2017-12-26 19.52.19.jpg' >\n  <img src='/img/dasung_teardown/2017-12-26 19.52.19.jpg' title=\"How to dissasemble Dasung Paperlike Pro\" alt=\"How to dissasemble Dasung Paperlike Pro\" />\n</a><a href='/img/dasung_teardown/2017-12-26 19.54.26.jpg'>\n  <img src='/img/dasung_teardown/2017-12-26 19.54.26.jpg' alt=\"How to unscrew Dasung Paperlike Pro\" title=\"How to unscrew Dasung Paperlike Pro dissasembly\" />\n</a><h2>The Dasung E-ink display module</h2>\n<p>My main objective in purchasing the Dasung, was to confirm what e-ink display module was in use. I had suspected it was the <a href=\"http://shopkits.eink.com/product/13-3%CB%9D-epaper-display-ed133ut2/\">13.3 ePaper Display (ED133UT2)</a> However other notes from Dasung about a &#34;Carta&#34; version change lead me to doubt that. One of my biggest complaints in my <a href=\"2018/01/12/dasung-paperlike-pro-review\">Dasung Paperlike Pro Review</a> post, was that the monitor display was reflective and has an aggressive glare.</p>\n<a href='/img/dasung_teardown/2017-12-26 19.56.24.jpg'>\n  <img src='/img/dasung_teardown/2017-12-26 19.56.24.jpg' alt=\"\" title=\"\" />\n</a><h3>Detaching the E-ink display module</h3>\n<p>This step was sensitive. The Display module is attached by a fragile ribbon cable to a latch bracket. This is called a ZIF (Zero Insertion Force) connector. It took me a bit to track down how to open it. You Lift the black latch off and can remove the ribbon cable.</p>\n<a href='/img/dasung_teardown/2017-12-26 20.28.23.jpg'>\n  <img src='/img/dasung_teardown/2017-12-26 20.28.23.jpg' alt=\"How to open ZIF (Zero Insertion Force) connector\" title=\"How to open ZIF (Zero Insertion Force) connector\" />\n</a><a href='/img/dasung_teardown/2017-12-26 21.21.55.jpg'>\n  <img src='/img/dasung_teardown/2017-12-26 21.21.55.jpg' alt=\"\" title=\"\" />\n</a><h3>Reviewing the E-ink Epaper display module</h3>\n<p>On inspection of the E-ink display module I was disappointed to find that the glass was actually part of the module and not a separate pane like I first expected and hoped.</p>\n<a href='/img/dasung_teardown/2018-02-07 19.31.52.jpg'>\n  <img src='/img/dasung_teardown/2018-02-07 19.31.52.jpg' alt=\"Broken glass on dasung e-ink display module\" title=\"borken glass on dasung e-ink module\" />\n</a><a href='/img/dasung_teardown/2018-02-07 19.30.16.jpg'>\n  <img src='/img/dasung_teardown/2018-02-07 19.30.16.jpg' alt=\"e-ink module identification\" title=\"e-ink module identification\" />\n</a><p>The tag on the display module has a model number <b>ED133UT2</b> that confirms my suspicious of it being the <a href=\"http://shopkits.eink.com/product/13-3%CB%9D-epaper-display-ed133ut2/\">e-ink 13.3 ed133ut2</a>. This is unfortunate as it appears that E-ink  offers another module the <b>ES133UT2</b> model. Note that the difference between the model numbers is the <b>S</b> and <b>D</b>. The <b>S</b> model is marketed as &#34;Flexible&#34; and has sales points of:</p>\n<ul><li>Antiglare hard-coated front-surface</li>\n<li>Plastic substrate</li>\n</ul>\n<p>It is hugely disappointing that Dasung went with the <b>D</b> model as I suspect the <b>S</b> model would be an <a href=\"http://shopkits.eink.com/product/13-3%CB%9D-epaper-display-es133ut2/\">anti-glare e-ink display module</a> solving a major problem with the Dasung. I could almost see a mistake being made during production ordering because of the very close model identifiers.</p>\n<p>On further exploration of these model numbers I found a <a href=\"http://www.panelook.com/product_cat.php?catid=73&pl=photo&st=&tag=74&panel_size_inch=1330\">PaneLook.com a whole sale display panel site</a> which lists other 13.3 e paper, display models:</p>\n<ul><li><b>EN133UT1</b></li>\n<li><b>ES133UT1</b></li>\n<li><b>ED133UT1</b></li>\n<li><b>ED133TT1</b></li>\n<li><b>ES133TT2</b></li>\n<li><b>ES133TE1</b></li>\n<li><b>ED133UT2</b></li>\n<li><b>ES133TT3</b></li>\n</ul>\n<p>Panelook curiously does not have a listing for <b>ES133UT2</b></p>\n<p>A <a href=\"http://www.panelook.com/modelcompare.php?ids=25596,25552,25553,27057,27058,27059,31868,31869\">comparison of 13.3 epaper displays</a> on PaneLook shows some interesting details about the available options.</p>\n<ul><li>The <b>ES133TE1</b> has embbed touch screen capabilities.</li>\n<li><b>EN133UT1</b> and <b>ES133TT3</b> are the only models listed with &#39;Antiglare&#39;</li>\n</ul>\n<p>After comparing these options it looks as if <b>ES133TT3</b> would be the best Epaper laptop display from these options.</p>\n<h2>The Control Board</h2>\n<p>When I first saw this control board I was shocked at how large it is and how many components are packed into it. I had assumed that most of the proprietary Dasung functionality was handled in software.</p>\n<a href='/img/dasung_teardown/2017-12-26 21.33.30.jpg' >\n  <img src='/img/dasung_teardown/2017-12-26 21.33.30.jpg' alt=\"Dasung Paperlike control board\" title=\"Dasung Paperlike Pro control board\" />\n</a><p>On closer inspection all the chip components have had their labels chemically peeled off to prevernt reverse engineering.</p>\n<h3>Two PCBs ?</h3>\n<p>There are actually two PCBs. A smaller PCB towards the top of the enclosure is a USB port with an IC and wires hooked to the main board.</p>\n<a href='/img/dasung_teardown/2017-12-26 20.22.38.jpg' >\n  <img src='/img/dasung_teardown/2017-12-26 20.22.38.jpg' alt=\"Dasung Paperlike control board\" title=\"Dasung Paperlike Pro control board\" />\n</a><p>The Dasung manual claims that this USB port is intended to be used as an interface for a USB external lamp. Then elsewhere, on the included accessories section of a &#39;quick start&#39; sheet, it says:</p>\n<ul><li>A USB to USB cable for firmware upgrade in some emergency (non standard).</li>\n</ul>\n<p>This implies that the USB interface can used for firmware updates. I suspect with some further hacking this could be used to load custom firmware or maybe dump the existing firmware of the board.</p>\n<p>There are only two input ports to the device. The USB on top, and the mini HDMI in the bottom left.</p>\n<h1>Dasung Paperlike Pro control board components</h1>\n<p>I am way too junior in electronics to accurately identify the components of the board. I leave this as an exercise for any readers, and a learning challenge for myself. I will pursue this in future work.</p>\n<p>I reached out to some 3rd party help and the best lead I got was:</p>\n<blockquote><p>from top to bottom...\nsome kind of IO breakout, maybe an MCU for platform management, might actually be running the whole show and below is just a display controller\nmain SoC, probably contains display driver they&#39;re using for just the internal screen\nthe two little ones are DRAM\nan FPGA, used as glue logic and DMA buffer for both displays\nhighly integrated hdmi controller, handles the full spec + audio and just clocks in a frame</p>\n<p>the collection of shit in the white boxes are various power regulators for the display etc, on the far top left you have a power management controller and support circuitry, handles just about all the IC and IO voltages by the looks.</p>\n</blockquote>\n<p>Looking forward to further discussion in the comments.</p>\n<h1>Updates</h1>\n<h2>2018/02/14</h2>\n<p>User thomasjfox on <a href=\"https://hackaday.com/2018/02/14/tearing-down-a-1000-e-ink-display/#comment-4362437\">hackaday comments</a> suggests:</p>\n<blockquote><p>On the bottom left is a HDMI signal decoder that feeds directly into a FPGA with RAM chips next to it.\nThe FPGA is connected to the eink controller on the right. I couldnt make out the largish chip above the eink controller.\nWild guess: A MCU to configure the HDMI signal decoder + eink controller.</p>\n</blockquote>\n","excerpt":"Disclaimer This is my first real electronics, hardware project. I'm picking this up as I go. I don't yet have a mature mental model on electronics. I appreciate any guidance and coaching in the comments.\n\nBuilding a DIY E-ink or Epaper laptop\nThis is a follow up to my previous Dasung Paperlike Pro Review post. For visitors landing here, a quick recap. The Dasung Paperlike Pro is billed as ...","slug":"2018/02/11/dasung-paperlike-pro-teardown","meta":{"keywords":"e-ink hardware workflow laptop","image":"img/dasung_teardown/title.png","description":"A hardware teardown of the Dasung Paperlike Pro E-ink monitor as part of a research effort to build an DIY E-ink laptop"}},{"title":"Dasung Paperlike Pro(grammer) Review","date":"2018-01-12","contentHTML":"<p>I recently purchased a <a href=\"http://www.dasung.com/english/\">Dasung Paperlike Pro 13.3 E-ink monitor</a> to use for coding, reading, and terminal work. I have many thoughts on the overall e-ink market and consumer experience. I will save them for another post. This post will be brief and focused on personal expectations with the Dasung. Additionally, there are <a href=\"https://www.youtube.com/results?search_query=dasung+paperlike+pro\">many other, more thorough reviews</a> online demonstrating the capabilities of the monitor.</p>\n<p>After telling people I purchased this monitor the common reaction is:</p>\n<blockquote><p>&#34;E-ink? Isn&#39;t that slow!? How do you code on that?&#34; - Tech Friend</p>\n</blockquote>\n<p>This is an understandable concern as most people&#39;s personal experience with E-ink has been on smaller low powered devices like Kindles or other E-readers.  The smaller e-reader screens tend to have an extended &#39;refresh&#39; rate built in. This is an attempt to conserve battery power.</p>\n<p>The Dasung doesn&#39;t have to make this compromise; it has a dedicated power source. The Dasung monitor performance runs at about 40 FPS on HDMI hookup. This thing can play videos.</p>\n<h2>Coding in Emacs on a Dasung Paperlike Pro 13.3 E-ink monitor</h2>\n<p>Below is a video I sent to a few friends demonstrating the responsiveness and performance</p>\n<p>e-ink emacs video:</p>\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/zp8-eUmAnhg\" frameborder=\"0\" allow=\"autoplay; encrypted-media\" allowfullscreen></iframe><h2>The pros</h2>\n<ul><li>The overall physical design and form factor of the monitor is great.<p>The monitor has a solid one-piece construction. As a bonus, it comes with a stand. HDMI hookup</p>\n</li>\n<li>Works excellent for Emacs.<p>Can be a dedicated Emacs monitor.</p>\n</li>\n<li>Dasung support was fast, friendly and shipping was quick.</li>\n</ul>\n<h3>Dasung driver and software performance</h3>\n<p>Dasung packages software to help drive and configure the monitor on popular operating systems: Windows, OSX, and 64bit Ubuntu. I primarily used the monitor on an OSX system.</p>\n<p>The Monitor has three primary rendering modes: <b>Floyd</b>, <b>A2</b>, <b>A16</b>. I find myself spending most of the time in the <b>A2</b> mode. The different modes correspond to different algorithms that the monitor uses to convert the colored display pixel data into grey-scale e-ink data. The numbers in the <b>A2</b> and <b>A16</b> modes are the different shades of grey each pixel will render. The <b>A2</b> mode is a hard binary contrast containing only 2 colors, black and white. I found this great for text editing and reading.</p>\n<p>The <b>A16</b> mode maps color pixels into one of 16 shades of grey. This mode is useful for viewing operating system UI and Apps that don&#39;t render well in a black and white mode.</p>\n<p>The <b>Floyd</b> mode is apparently a proprietary custom Dasung algorithm that is based on <del>[[<a href=\"https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm][The\">https://en.wikipedia.org/wiki/FloydWarshall_algorithm][The</a> Floyd-Warshall algorithim]]</del> <a href=\"https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering\">FloydSteinberg dithering algorithim</a>. Overall the <b>Floyd</b> mode renders multi shade grey output at a high frame rate. You can watch videos in this mode. Wikipedia states that:</p>\n<blockquote><p><del>the FloydWarshall algorithm is an algorithm for finding shortest paths in a weighted graph with positive or negative edge weights (but with no negative cycles).</del></p>\n</blockquote>\n<p>I am not sure how Dasung applies that graph pathfinding algorithm to the pixel data of the display output. I haven&#39;t thought too hard about this yet, I would appreciate any ideas left in the comments below.</p>\n<h2>The cons</h2>\n<h3>Reflective screen glare</h3>\n<p>As you can see in the video above, there is an obvious glare on the screen. The video was captured in a moderately lit room. The monitor actually ships with a plastic anti-glare protective screen cover to help alleviate this. This is a huge problem and defeats the purpose of the monitor. Dasung&#39;s advertising is aggressive on claims of &#34;Relax Your Eyes&#34;, &#34;Ultimate Eye Protection&#34; &#34;No blue light, No flashing, No backlight, No glossy&#34;.</p>\n<p>Unfortunately, putting a reflective pane of glass over the e-ink display is a bad move.</p>\n<h3>Dasung driver and software issues</h3>\n<p>I listed the Dasung software as a Pro, unfortunately, it also has some frustrating issues. Again my experience was on MacOSX; your experience may be different.</p>\n<p>The monitor has a &#34;change mode&#34; hardware button that lets you cycle through these differnt modes. There is a software driver UI that also changes these modes. It seems the software can get out of sync with the hardware. You can set a resolution and contrast and mode in the software, Then press a hardware button and that resolution will be lost.</p>\n<p>At times the monitor goes in to some kind of &#34;sleep mode&#34; even while plugged into an active computer. The screen goes black and unresponsive. By messing with a combination of the hardware buttons on the screen you can wake it up.</p>\n<p>Unfortunatly, the driver UI defaults to Chinese, I was able to navigate it blindly and change to English. It should detect the operating system&#39;s language setting.</p>\n<h1>Summary</h1>\n<p>Overall I think the Dasung is a pretty awesome piece of equipment. I am majorly dissapointed about the reflective glass screen. I am happy with my purchase and hope funds go to help further improve the company and product line. If you spend a lot of time editing text or reading with tired eyes I would recommend one. You can use it as a dedicated text editor or terminal screen to great success.</p>\n<h1>Updates</h1>\n<h2>2018/02/02:</h2>\n[[<a href=\"https://kevzettler.com/2018/01/12/dasung-paperlike-pro-review#comment-3754833721\">https://kevzettler.com/2018/01/12/dasung-paperlike-pro-review#comment-3754833721</a>][Jon Hendry]] in the comments pointed out that the Dasung PaperlikePro Floyd mode is probably the <a href=\"https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering\">FloydSteinberg dithering algorithim</a> and not the Floyd-Warshall I pointed out above. This makes much more sense I have updated the content above","excerpt":"I recently purchased a Dasung Paperlike Pro 13.3 E-ink monitor to use for coding, reading, and terminal work. I have many thoughts on the overall e-ink market and consumer experience. I will save them for another post. This post will be brief and focused on personal expectations with the Dasung. Additionally, there are many other, more thorough reviews online demonstrating the capabilities of the ...","slug":"2018/01/12/dasung-paperlike-pro-review","meta":{"keywords":"e-ink hardware workflow","image":"img/kev.jpeg","description":"I recently purchased a Dasung Paperlike Pro 13.3 E-ink monitor to use for coding, reading, and terminal work. I have many thoughts on the overall e-ink market and consumer experience. I will save them for another post. This post will be brief and focused on personal expectations with the Dasung. Add"}},{"title":"Rapid Local Development with Vagrant, Docker and Node.js","date":"2015-06-07","contentHTML":"<h3 id=\"tldr\">TLDR</h3>\n<ul>\n<li>Using a cascade of Vagrant shared directories, Docker volumes and cleverly placed symlinks, you can rig Vagrant and Docker to instantly reflect your local application code updates.</li>\n<li>Docker volume -&gt; Vagrant shared directory -&gt; Host machine code.</li>\n<li>Enable NPM link style development in Docker container.</li>\n<li>Dosen&#39;t cover <code>gulp</code> <code>webpack</code> asset generation but you can figure it out.</li>\n<li>There might be a better way to do this or improvements to make. Leave it in the comments.</li>\n</ul>\n<h2 id=\"the-problem\">The Problem</h2>\n<p>I wanted to use <a href=\"https://github.com/js-platform/node-webrtc\">isomorphic WebRTC</a> with the awesome <a href=\"https://github.com/feross/simple-peer\">SimplePeer</a> in a recent Node.js project. However the server WebRTC has a bunch of system level dependencies that are a pain to install. Luckily they provide a <a href=\"https://github.com/js-platform/node-webrtc/blob/develop/Dockerfile\">Dockerfile</a> which does it all for you. I didn&#39;t end up using their exact Dockerfile but copy pasted the majority of it to my project to use as a <code>Base web</code> Dockerfile.</p>\n<p>I also wanted to do development on a custom Node module. Usually on your local machine you would do <code>npm link</code> which creates a symlink to your module&#39;s code directory and you can rapidly iterate there. However, working with Vagrant and Docker makes this more complicated.</p>\n<p>I wanted all this to work without having to rebuild Docker images, rerun docker containers, or reprovision Vagrant.</p>\n<h2 id=\"the-base-web-image\">The Base Web Image</h2>\n<pre><code class=\"language-docker\"># baseweb Dockerfile\nFROM ubuntu:14.04\n\nENV DEBIAN_FRONTEND noninteractive\nRUN echo debconf shared/accepted-oracle-license-v1-1 select true | debconf-set-selections\nRUN echo debconf shared/accepted-oracle-license-v1-1 seen true | debconf-set-selections\n\nRUN apt-get update &amp;&amp; apt-get install -y software-properties-common\nRUN add-apt-repository ppa:webupd8team/java &amp;&amp; add-apt-repository ppa:chris-lea/node.js &amp;&amp; apt-get update\n\nRUN apt-get install -y git subversion g++ python libnss3-dev libasound2-dev libpulse-dev \\\nlibjpeg62-dev libxv-dev libgtk2.0-dev libexpat1-dev libxss-dev libudev-dev libdrm-dev libgconf2-dev \\\nlibgcrypt11-dev libpci-dev libxtst-dev libgnome-keyring-dev libssl-dev nodejs oracle-java6-installer oracle-java6-set-default\n\nENV JAVA_HOME /usr/lib/jvm/java-6-oracle/\nENV PATH $PATH:/usr/lib/jvm/java-6-oracle/jre/bin/\n\n\nRUN npm install -g forever\n</code></pre>\n<p>With the <code>BaseWeb</code> Dockerfile inplace I then have my Nodejs application. It&#39;s structured as follows.</p>\n<h2 id=\"the-web-application-code\">The Web Application Code</h2>\n<pre><code class=\"language-bash\">/Projects/demo/web\n Dockerfile\n index.js\n node_modules -&gt; /dist/node_modules/\n package.json\n</code></pre>\n<p>Take note here that my <code>node_modules</code> is actually a symlink to <code>/dist/node_modules/</code> this is committed to my repo. This may seem odd but it&#39;s key to letting us rapidly develop on a custom module. It enables a <code>npm link</code> style work flow.</p>\n<h3 id=\"the-vagrant-setup\">The Vagrant Setup</h3>\n<p>Assume we have a Vagrantfile outside of our web project like so:</p>\n<pre><code class=\"language-bash\">/Projects/demo/\n Vagrantfile\n web\n</code></pre>\n<p>This will automatically mount the web code as a shared directory inside the Vagrant machine at <code>/vagrant/web</code>. At this point we can <code>vagrant up</code> and edit the application code on the host machine as usual and Vagrant will pickup the changes. This dosen&#39;t help us yet because the code is dependent on the ismorphic WebRTC dependences. We need Vagrant to run the Docker containers.</p>\n<p>Before we get to the <code>Vagrantfile</code> let&#39;s look at the Web Applications&#39; Dockerfile.</p>\n<h2 id=\"the-web-application-dockerfile\">The Web Application Dockerfile</h2>\n<pre><code class=\"language-dockerfile\"># web DockerFile\nFROM base_web\nCOPY package.json /dist/package.json\nRUN mkdir /dist/node_modules &amp;&amp; cd /dist &amp;&amp; npm install\nADD . /srv/www\nRUN ln -s /dist/node_modules /srv/www/node_modules\nWORKDIR /srv/www\nEXPOSE 5000\nCMD [&quot;forever&quot;, &quot;index.js&quot;]\n</code></pre>\n<h4 id=\"points-of-interest\">Points Of Interest</h4>\n<ul>\n<li><p>The key to this whole thing here is the <code>node_modules</code> setup. We don&#39;t do the <code>npm install</code> in the application code directory. We create a <code>/dist/</code> directory and copy <code>package.json</code> there. We then <code>npm install</code> in <code>/dist</code> and get <code>/dist/node_modules</code>. This is really the seceret sauce. In production you dont rebuild your modules each time you re-build your container. If your <code>package.json</code> file changes then your modules will be rebuilt. I got this from  <a href=\"http://bitjudo.com/blog/2014/03/13/building-efficient-dockerfiles-node-dot-js/\">Building Efficient Dockerfiles</a></p>\n</li>\n<li><p><code>RUN ln -s /dist/node_modules /srv/www/node_modules</code></p>\n<p> This creates a symlink for <code>node_modues</code> from our application code at <code>/srv/www</code>. to our <code>/dist</code>. This also overrides the symlink that is committed in the web repo. You might be thinking, &quot;well what was the point of that then?&quot;. I promise we&#39;ll get to that soon. It&#39;s key to the <code>npm link</code> style.</p>\n</li>\n</ul>\n<h3 id=\"the-vagrant-file\">The Vagrant File</h3>\n<pre><code class=\"language-ruby\">Vagrant.configure(2) do |config|\n  config.vm.box = &quot;Ubuntu 14.04 with Docker enabled&quot;\n  config.vm.box_url = &quot;https://github.com/jose-lpa/packer-ubuntu_14.04/releases/download/v2.0/ubuntu-14.04.box&quot;\n\n  config.vm.provision &quot;docker&quot; do |d|\n    d.build_image &quot;/vagrant/Dockerfiles/base_web&quot;, args: &#39;-t &quot;base_web&quot;&#39;\n    d.build_image &quot;/vagrant/web&quot;, args: &#39;-t &quot;web&quot;&#39;\n\n    d.run &quot;web&quot;,\n          cmd: &quot;forever -w bin/server.js&quot;,\n          args: &quot;-v &#39;/vagrant/web:/srv/www&#39;\\\n                 -e NODE_ENV=development\\\n                 -p 5000:5000&quot;\n  end\n\n  config.vm.network &quot;forwarded_port&quot;, guest: 5000, host: 5000\nend\n</code></pre>\n<h4 id=\"points-of-interest-1\">Points of interest</h4>\n<ul>\n<li>We use a &#39;Docker enabled&#39; image for our Docker box.</li>\n<li>We use Vagrant&#39;s built-in Docker provisioner.</li>\n<li>We then run our container with some new arguments.</li>\n</ul>\n<p>Let&#39;s look at the run command more in-depth.</p>\n<pre><code class=\"language-ruby\">    d.run &quot;web&quot;,\n          cmd: &quot;forever -w index.js&quot;,\n          args: &quot;-v &#39;/vagrant/web:/srv/www&#39;\\\n                 -e NODE_ENV=development\\\n                 -p 5000:5000&quot;\n</code></pre>\n<p>We&#39;re overriding the Dockerfiles&#39; <code>CMD [&quot;forever&quot;, &quot;index.js&quot;]</code> with <code>forever -w index.js</code> The <code>-w</code> flag restarts our server on code updates, which is what we want in a development environment.</p>\n<h3 id=\"bringing-it-all-together\">Bringing It All Together</h3>\n<p>The Most important part of the <code>docker run</code> options is the <code>-v</code> flag, which is for Docker Volumes. We are telling our container to mount <code>/srv/www</code> as a volume that points to <code>/vagrant/web/</code>. If you review our Vagrant setup from earlier you can see that <code>/srv/www</code> is actualy a shared directory to our application code directory <code>/web</code> on the host machine!</p>\n<p>A quick diagram of this shared filesystem cascade looks like this:</p>\n<pre><code class=\"language-bash\">Docker `/srv/www` -&gt;\nVagrant `/vagrant/web -&gt;\nHost `/web`/\n</code></pre>\n<p>At this point you&#39;re set up to rapidly develop on your application code and have updates reflected in your Docker container.</p>\n<p>The next challenge I faced was figuring out how to handle a local NPM module dependency that I wanted to iterate on in the same rapid manner.</p>\n<h2 id=\"npm-link-development-in-a-docker-container\">NPM Link Development In A Docker Container</h2>\n<p>So in this scenario. Lets assume that <code>web</code> has an entry in <code>package.json</code> like this:</p>\n<pre><code class=\"language-json\">  &quot;dependencies&quot;: {\n   &quot;customModule&quot;: &quot;git://github.com/kevzettler/customModule&quot;,\n   }\n</code></pre>\n<p><code>customModule</code> is a NPM module that we maintain and develop. This package.json setup works fine for production because we just install from the repo and forget about it. In development we want to rapidly make changes to <code>customModule</code>and not have to rebuild everything. Normally when developing on local machine, we would <code>cd</code> into <code>web</code> and do <code>npm link customModule</code> which would build a symlink to our <code>customModule</code> code that would give us a rapid development setup.</p>\n<p>When we add Vagrant and Docker to the dev environment, this completly breaks NPM Link.</p>\n<p>Here&#39;s an updated directory diagram of our project with the new <code>customModule</code> code:</p>\n<pre><code class=\"language-bash\">/Projects/demo/\n Vagrantfile\n web\n customModule\n</code></pre>\n<p>So similliar to the web code, Vagrant will mount our customModule code at <code>/vagrant/customModule</code></p>\n<p>We can then update our VagrantFile to add a new Docker Volume:\n<code>-v &#39;/vagrant/engine:/dist/node_modules/engine&#39;</code></p>\n<pre><code class=\"language-ruby\">    d.run &quot;web&quot;,\n          cmd: &quot;forever -w index.js&quot;,\n          args: &quot;-v &#39;/vagrant/web:/srv/www&#39;\\\n                 -v &#39;/vagrant/customModule:/dist/node_modules/customModule&#39;\\\n                 -e NODE_ENV=development\\\n                 -p 5000:5000&quot;\n</code></pre>\n<h3 id=\"whats-all-this-symlink-business-then\">What&#39;s All This Symlink Business Then?</h3>\n<p>So we have this symlink in 2 places.</p>\n<ul>\n<li><p>The <code>RUN</code> symlink in Web Dockerfile\n  <code>RUN ln -s /dist/node_modules /srv/www/node_modules</code></p>\n</li>\n<li><p>In &#39;Filesystem&#39; symlink\n  <code>node_modules -&gt; /dist/node_modules/</code></p>\n</li>\n</ul>\n<p>Docker does not support symlinks when using the <code>ADD</code> command in a DockerFile.\nIt will drop them from the <code>ADD</code> filesystem. That&#39;s why we need the <code>RUN</code> symlink in the dockerfile.</p>\n<p>When we want to do development work, we run the container with the <code>-v</code> flag to mount our local code. The volume doesn&#39;t get attached until after our container has already been created. At that time, the <code>RUN</code> symlink exists; however, the <code>-v</code> option overrides everything in the container&#39;s <code>/srv/www/</code>, wiping out the <code>RUN</code> symlink.</p>\n<p>But wait! We have a &#39;Filesystem&#39; symlink in our shared code. The volume respects this symlink and it routes internally to the container&#39;s filesystem. You don&#39;t necessarily have to commit the symlink to your repo like I was dong. You just need it around when you build the Docker image. I committed it because I kept forgetting. Try this out and let me know if you have a better solution to it.</p>\n","excerpt":"TLDR\n\nUsing a cascade of Vagrant shared directories, Docker volumes and cleverly placed symlinks, you can rig Vagrant and Docker to instantly reflect your local application code updates.\nDocker volume -> Vagrant shared directory -> Host machine code.\nEnable NPM link style development in Docker container.\nDosen't cover gulp","slug":"2015/06/07/rapid_local_development_vagrant_docker_node","meta":{"keywords":["JavaScript","Conventions","Docker","Vagrant","Node.js"],"image":"img/kev.jpeg","description":"TLDR\n\nUsing a cascade of Vagrant shared directories, Docker volumes and cleverly placed symlinks, you can rig Vagrant and Docker to instantly reflect your local application code updates.\nDocker volume -&gt; Vagrant shared directory -&gt; Host machine code.\nEnable NPM link style development in Docker"}},{"title":"How To Route Docker.io Containers To Public IPV6 on Linode","date":"2014-06-25","contentHTML":"<ul>\n<li>If you want to us ipv6 with docker.io on linode make sure you have the following <code>sysctl</code> set<ul>\n<li><code>net.ipv6.conf.all.accept_ra = 2</code></li>\n<li><code>net.ipv6.conf.all.forwarding = 1</code></li>\n</ul>\n</li>\n<li>Then you can pretty much follow this post <a href=\"http://zargony.com/2013/10/13/ipv6-in-docker-containers#sthash.xNFG3NCx.dpuf\">http://zargony.com/2013/10/13/ipv6-in-docker-containers</a></li>\n<li>If you want auto configured addresses you can install and configure <code>radvd</code></li>\n</ul>\n","excerpt":"\nIf you want to us ipv6 with docker.io on linode make sure you have the following sysctl set\nnet.ipv6.conf.all.accept_ra = 2\nnet.ipv6.conf.all.forwarding = 1\n\n\nThen you can pretty much follow this post http://zargony.com/2013/10/1...","slug":"2014/06/25/docker_ipv6_linode","meta":{"keywords":["JavaScript","Conventions","Docker.io","IPV6","Linode"],"image":"img/kev.jpeg","description":"\nIf you want to us ipv6 with docker.io on linode make sure you have the following sysctl set\nnet.ipv6.conf.all.accept_ra = 2\nnet.ipv6.conf.all.forwarding = 1\n\n\nThen you can pretty much follow this post http://zargony.com/2013/10/13/ipv6-in-docker-containers\nIf you want auto configured addresses you "}},{"title":"How To Manage Javascript Callbacks","date":"2012-09-30","contentHTML":"<h3 id=\"tldr\">tldr;</h3>\n<ul>\n<li>Abstract anonymous functions into named functions to avoid nesting callbacks.</li>\n<li>Avoid using local variables of a shared scope in nested anonymous functions.</li>\n<li>Abstract large JavaScript object declaration into smaller generator functions.</li>\n</ul>\n<h2 id=\"or-how-to-avoid-callback-hell\">Or &#39;How To Avoid Callback Hell&#39;.</h2>\n<p>I have been meaning to write this post for some time now. Basically since Node.js came onto the spotlight and people started complaining about JavaScript code maintainability and readability due to\nnested callbacks and other asynchronous patterns. This is also highly relevant now with the rise of backbone.js and the discussion for best practices there. Writing JavaScript like Lisp is a bit of an generalization. More specifically, I mean write JavaScript like its a functional language, which it is.\nBy this, I mean write it as small composable functions. I&#39;ll show a few patterns I use that can help keep your JavaScript more manageable. Lets get into some code examples.</p>\n<h2 id=\"a-standard-jquery-ajax-button-event\">A Standard jQuery Ajax Button Event.</h2>\n<p>This is fairly common pattern. A button click event triggers an Ajax request. The Ajax request has callbacks for success and error. The success callback triggers another procedure of rendering or possibly another Ajax chain.\nThe error function does some animation to the button and then does some Ajax to log the error.</p>\n<pre><code class=\"language-javascript\">    $(&#39;button&#39;).click(function(event){\n      $.ajax({\n        url: &quot;http://coolsite.com&quot;\n        ,data: {\n          &quot;lots&quot; : &quot;of&quot;\n          ,&quot;json&quot; : &quot;data&quot;\n        }\n        ,success: function(data){\n          $(&#39;button&#39;).fadeOut(function(){\n            alert(&#39;Ajax success!&#39;);\n          });\n        },\n        error: function(data){\n          $(&#39;button&#39;).animate({top: &#39;20px&#39;}, function(){\n            $.get(&quot;http://coolsite.com/logger&quot;, function(){\n               console.log(&#39;error happened&#39;);\n            });\n        });\n        }\n      });\n    });\n</code></pre>\n<p>Everything is stuffed into the click handler. All of the Ajax response functions are nested in the scope of the anonymous click handler function.\nWhile this is not necessarily a bad practice, it can promote the growth of unmanageable code.</p>\n<p>A familiar scenario, someone might declare a local variable at the top of the click handler declaration and then reference it throughout the nested anonymous functions. This will essentially cause the <code>success</code> and <code>error</code> callbacks to be dependent on their nested position.</p>\n<h2 id=\"how-can-we-make-this-better\">How Can We Make This Better?</h2>\n<p>Well lets break it up into smaller pieces. More manageable pieces.</p>\n<pre><code class=\"language-javascript\">    function ajaxSuccessHandler(data){\n      $(&#39;button&#39;).fadeOut(function(){\n        alert(&#39;Ajax success!&#39;);\n      });\n    }\n\n    function ajaxErrorHandler(data){\n      $(&#39;button&#39;).animate({top: data.top}, function(){\n        $.get(&quot;http://coolsite.com/logger&quot;, function(){\n          console.log(&#39;error happened&#39;);\n        });\n      });\n    }\n\n    function buttonClickHandler(event){\n      $.ajax({\n        url: &quot;http://coolsite.com&quot;\n        ,data: {\n          &quot;lots&quot;: &quot;of&quot;\n          ,&quot;json&quot;: &quot;data&quot;\n        }\n        ,success: ajaxSuccessHandler\n        ,error: ajaxErrorHandler\n      });\n    }\n\n    $(&#39;button&#39;).click(buttonClickHandler);\n</code></pre>\n<h2 id=\"its-okay-to-use-named-functions\">Its Okay To Use Named Functions.</h2>\n<p>We&#39;ve made a few small abstractions. We&#39;ve moved the anonymous functions that handle the button click, Ajax success, and Ajax error into separate named functions.\nSimply giving the anonymous functions names and moving them out of the nested pattern has significantly improved this code.</p>\n<p>Visually the code is now easier to parse. The callbacks are now standalone units that can be tested in isolation.\nWe could easily write a unit test for <code>ajaxSuccessHandler</code> that called it with a dummy data object and ensured it was functioning correctly. This is significantly harder when nesting anonymous functions.</p>\n<p>Stack traces now become more useful as well. Trying to hunt down a bug in a stack trace that is 3 layers deep in anonymous functions is not helpful. If the functions are named its much easier to track down issues.</p>\n<p>Another added benefit of this pattern is that it now makes it easy to annotate our functions to utilize the features of <a href=\"https://developers.google.com/closure/compiler/docs/js-for-compiler\">Google&#39;s Closure Compiler</a>.\nThis opens up the opportunity to add strict type checking to our JavaScript.</p>\n<p>Expanding on our re-factor, we could have abstracted the anonymous callbacks passed to the <code>fadeOut</code> and <code>animate</code> invocations. Also the callback passed to our <code>$.Get</code> call is ripe for naming as well.\nFor this small example we&#39;ll skip editing them as its a bit overkill. In larger code bases you&#39;ll see those functions swell.</p>\n<h2 id=\"generate-large-objects-from-named-functions\">Generate Large Objects From Named Functions.</h2>\n<p>This next example is a bit exaggerated but gets the concept across.\nOften times you may have some JavaScript objects defined inline as a parameter or local variable.\nIn our example, we have the <code>$.ajax</code> method which takes an Object as its parameter and a child object as the <code>data:</code> value.\nIn our next example code, we abstract these small objects in to some simple named functions that simply return the objects.</p>\n<pre><code class=\"language-javascript\">    function ajaxSuccessHandler(data){\n      $(&#39;button&#39;).fadeOut(function(){\n        alert(&#39;Ajax success!&#39;);\n      });\n    }\n\n    function ajaxErrorHandler(data){\n      $(&#39;button&#39;).animate({top: data.top}, function(){\n        $.get(&quot;http://coolsite.com/logger&quot;, function(){\n          console.log(&#39;error happened&#39;);\n        });\n      });\n    }\n\n    function buttonClickAjaxData(){\n      return {\n          &quot;lots&quot;: &quot;of&quot;\n          ,&quot;json&quot;: &quot;data&quot;\n        };\n    }\n\n    function buttonClickAjaxObj(){\n      return {\n        url: &quot;http://coolsite.com&quot;\n        ,data: buttonClickAjaxData()\n        ,success: ajaxSuccessHandler\n        ,error: ajaxErrorHandler\n      };\n    }\n\n    function buttonClickHandler(event){\n      $.ajax(buttonClickAjaxObj());\n    }\n\n    $(&#39;button&#39;).click(buttonClickHandler);\n</code></pre>\n<p>This abstraction lets us contain the objects in to smaller functions that can be unit tested and managed much easier.\nAgain this is an exaggerated example and a bit overkill in this case, but definitely useful for larger objects.</p>\n<h2 id=\"just-for-fun\">Just For Fun.</h2>\n<p>For fun lets look at the above example in some bad pseudo Lisp.</p>\n<blockquote>\n<p><strong>Disclaimer</strong> I am by no means a certified Lisper.\nThe extent of my experience with Lisp is a few toy projects in Scheme and Common Lisp. The following code is meant to be more of visual aid than a functional program.</p>\n</blockquote>\n<h3 id=\"our-nested-ajax-procedure\">Our Nested Ajax Procedure.</h3>\n<p>I&#39;ve simplified <code>success</code> and <code>error</code> callbacks for this example to make them simple calls to <code>alert</code>\nYou can see this is visually similar to the way JavaScript nests anonymous functions.\nThis example makes use of Lisps anonymous functions with <code>lambda</code>. <code>lambda</code> is equivalent to JavaScripts <code>(function(){})</code></p>\n<pre><code class=\"language-cl\">    (on-click (lambda (event)\n      (ajax pseudo-data\n        (lambda (data) ; success\n          (alert data))\n        (lambda (data) ; error\n          (alert data)))))\n</code></pre>\n<h2 id=\"after-our-re-factor\">After Our Re-factor.</h2>\n<p>Below you can see that a similar clarity arises to our Lisp code when we abstract the anonymous functions in to named ones.\nWe now have self-contained small units of code that are much more manageable.</p>\n<pre><code class=\"language-cl\">    (defun success-callback (data) (alert data))\n\n    (defun error-callback (data) (jax-log data))\n\n    (defun click-handler (event)\n      (ajax pseudo-data success-callback error-callback))\n\n    (on-click click-handler)\n</code></pre>\n<h2 id=\"in-conclusion\">In Conclusion</h2>\n<p>If you&#39;re coming from a traditionally synchronous, procedural programming background. These patterns may not be a silver bullet for you.\nThis doesn&#39;t eliminate the need for callbacks. Hopefully it will help you manage them better. The code, in parts, is still written and executed in a non-sequential order.</p>\n","excerpt":"tldr;\n\nAbstract anonymous functions into named functions to avoid nesting callbacks.\nAvoid using local variables of a shared scope in nested anonymous functions.\nAbstract large JavaScript object declaration into smaller generator functions.\n\nOr 'How To Avoid Callback Hell'.\nI have been mea...","slug":"2012/09/30/how_to_manage_javascript_callbacks","meta":{"keywords":["JavaScript","Conventions"],"image":"img/kev.jpeg","description":"tldr;\n\nAbstract anonymous functions into named functions to avoid nesting callbacks.\nAvoid using local variables of a shared scope in nested anonymous functions.\nAbstract large JavaScript object declaration into smaller generator functions.\n\nOr &#39;How To Avoid Callback Hell&#39;.\nI have been meani"}},{"title":"Disable Any Element With jQuery","date":"2012-07-05","contentHTML":"<p>In HTML the <a href=\"http://www.w3schools.com/tags/att_input_disabled.asp\">disabled attribute</a> alows you to mark an input element as &#39;disabled&#39; Which will trigger \nthe browser to render the input in a &#39;greyed out&#39; style:</p>\n<table style=\"padding:20px;\">\n  <tr>\n    <td>\n      <form>\n        <p>Enabled elements</p>\n        <button >Click</button><br /><br />\n        <input type=\"text\"  value=\"text\" /><br />\n        <select ><br />\n          <option>Select</option>\n        </select>\n      </form>\n    </td>\n    <td>\n      <form style=\"padding-left:40px;\">\n        <p>Disabled elements</p>\n        <button disabled=\"disabled\">Click</button><br /><br />\n        <input type=\"text\" disabled=\"disabled\" value=\"text\" /><br />\n        <select disabled=\"disabled\"><br />\n          <option>Select</option>\n        </select>\n      </form>\n    </td>\n  </tr>\n</table>\n\n\n<p>This is helpful for limiting user interaction when an app is in an unknown state. Like waiting for an Ajax response. However this attribute is only available on form input elements.\nThis is unfortunate if you are heavily using your own custom UI components. Say you have a bunch of buttons throughout your UI that are actually <code>&lt;a&gt;</code> elements.</p>\n<p>I&#39;ve ran into this problem on several projects and developed a pattern which grew into a plugin I now use on most projects. You can get the plugin here <a href=\"https://github.com/kevzettler/jquery.disable/downloads\">download jquery.disable</a>\nor check it out and contribute to <a href=\"https://github.com/kevzettler/jquery.disable\">jquery.disable on github</a> </p>\n","excerpt":"In HTML the disabled attribute alows you to mark an input element as 'disabled' Which will trigger \nthe browser to render the input in a 'greyed out' style:\n\n  \n    \n      \n        Enabled elements\n        Click\n        ","slug":"2012/07/05/Disable_any_element_with_jquery","meta":{"keywords":null,"image":"img/kev.jpeg","description":"In HTML the disabled attribute alows you to mark an input element as &#39;disabled&#39; Which will trigger \nthe browser to render the input in a &#39;greyed out&#39; style:\n\n  \n    \n      \n        Enabled elements\n        Click\n        \n        \n          Select\n        \n      \n    \n    \n      \n    "}},{"title":"jQuery Autobox Plugin","date":"2010-10-30","contentHTML":"<p>I have worked on several site designs that expect form inputs to render with a default value. Upon focus of the input the default text should clear and allow user input to stick. Sometimes the design calls for this to happen with a password field as well.</p>\n<p>Password fields are a special condition as the text is rendered as dots. You cannot dynamically change the &#39;type&#39; attribute of a password input field. This is a browser security feature. To obtain this behavior with password fields you need to dynamically create a text field on top of the password and hide it on focus. This plugin handles this.</p>\n<pre><code> &quot;You cannot dynamically change the &#39;type&#39; attribute of a password input field.&quot;\n</code></pre>\n<p>Handle any font colors or styling with css.</p>\n<p>Downloads</p>\n<p><a href=\"https://github.com/kevzettler/jquery.autobox/tarball/master\">download - tar.gz</a></p>\n<p><a href=\"https://github.com/kevzettler/jquery.autobox/zipball/master\">download - .zip</a></p>\n<p>Installation</p>\n<pre><code>&lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;  \n&lt;script src=&quot;jquery.autobox.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;  \n&lt;script type=&quot;text/javascript&quot;&gt;&lt;/script&gt;  \n&lt;form&gt; &lt;input value=&quot;default text&quot; type=&quot;text&quot; /&gt; &lt;input value=&quot;default pass&quot; type=&quot;pass&quot; /&gt; &lt;/form&gt;  \n</code></pre>\n<p>Demo\nSee it live <a href=\"http://www.callmekev.com/demo\">here</a></p>\n","excerpt":"I have worked on several site designs that expect form inputs to render with a default value. Upon focus of the input the default text should clear and allow user input to stick. Sometimes the design calls for this to happen with a password field as well.\nPassword fields are a special condition as the text is rendered as dots. You cannot dynamically change the 'type' attribute of...","slug":"2010/10/30/jquery-autobox-plugin","meta":{"keywords":null,"image":"img/kev.jpeg","description":"I have worked on several site designs that expect form inputs to render with a default value. Upon focus of the input the default text should clear and allow user input to stick. Sometimes the design calls for this to happen with a password field as well.\nPassword fields are a special condition as t"}},{"title":"IE Button Bug","date":"2010-09-05","contentHTML":"<p>I recently encountered an annoying bug in multiple versions of IE regarding forms and button elements. I am writing about it to remind myself in the future and to hopefully save time for someone else. The bug spawned from my decision to use <code>&lt;button&gt;</code> elements over <code>&lt;input type=&quot;submit&quot;&gt;</code> elements as the submit buttons for my forms. I chose button elements because they are generally more consistent in cross browser rendering and also allow for more semantic textual content than text in the input element&#39;s type attribute.\nThe behavior of modern browsers matched my own expected behavior. That is:</p>\n<p>if a from element contains a button element, and no input <code>type=&#39;submit&#39;</code>, that button should trigger the submit event of the form</p>\n<p>However, IE does not.</p>\n<p>&quot;IE will not fire a form submit event on a <code>&lt;button&gt;&lt;/button&gt;</code> click by default.&quot;</p>\n<p>I found this out after testing in IE and discovering that none of the forms on a site would submit. I first assumed that it was some bug with an inline validation plugin that I had used. The submission bug remained after disabling the plugin.</p>\n<p>Solutions to this bug were: </p>\n<p>Replace all the button elements with input <code>type=&#39;submit&#39;</code> and apply the button styles. \nOr attach an explicit click event to the button elements that would fire the parent form elements submit event.</p>\n","excerpt":"I recently encountered an annoying bug in multiple versions of IE regarding forms and button elements. I am writing about it to remind myself in the future and to hopefully save time for someone else. The bug spawned from my decision to use <button> elements over <input type=\"submit\"> elements as the submit buttons for my forms. I chose button ele...","slug":"2010/09/05/IE-button-bug","meta":{"keywords":null,"image":"img/kev.jpeg","description":"I recently encountered an annoying bug in multiple versions of IE regarding forms and button elements. I am writing about it to remind myself in the future and to hopefully save time for someone else. The bug spawned from my decision to use &lt;button&gt; elements over &lt;input type=&quot;submit&qu"}}]},"__N_SSG":true}